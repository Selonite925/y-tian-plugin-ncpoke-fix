<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>gptx</title>
    <link rel="stylesheet" href="{{dz}}">
    <script src="{{showdown}}"></script>
    <link rel="stylesheet" href="{{atom_one_dark_min_css}}">
    <script src="{{highlight_min_js}}"></script>
</head>

<body>
    <div class="container">
        <div class="header">
            <div
                style="display: flex; align-items: center; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">
                <i class="fas fa-robot" style="font-size: 2rem; color: #007bff; margin-right: 0.5rem;"></i>
                <h1 style="margin: 0;">当前模型：<span
                        style="font-family: 'Courier New', Courier, monospace; background: linear-gradient(to right, #007bff, #6610f2); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">{{model}}</span>
                </h1>
            </div>
            <div class="header-bar"></div>
        </div>
        <div class="user2">
            <div id="title">
                <img src="http://q.qlogo.cn/headimg_dl?dst_uin={{id1}}&spec=640&img_type=jpg" alt="User 2 Avatar">
            </div>
            <div class="name">{{name}}</div>
            <div class="message">
                <div id="renderedMarkdown">{{MSG}}</div>
            </div>
        </div>
        <div class="user">
            <div id="title">
                <img src="http://q.qlogo.cn/headimg_dl?dst_uin={{id2}}&spec=640&img_type=jpg" alt="User 1 Avatar">
            </div>
            <div class="name">{{name1}}</div>
            <div class="message">
                <div id="renderedMarkdown2">{{CONTENT}}</div>
            </div>
        </div>
    </div>

    <script>
        hljs.highlightAll();

        const maxLength = 10000;

        // 分割 Markdown 文本为多个块
        function splitMarkdown(markdownText, maxLength) {
            const chunks = [];
            let start = 0;
            while (start < markdownText.length) {
                const end = start + maxLength;
                const chunk = markdownText.slice(start, end);
                chunks.push(chunk);
                start = end;
            }
            return chunks;
        }

        // 初始化 Showdown 转换器
        const converter = new showdown.Converter();

        // 处理第一个 Markdown 内容
        const markdownText = document.getElementById('renderedMarkdown').textContent;
        const chunks = splitMarkdown(markdownText, maxLength);
        const renderedHtml = chunks.map(chunk => {
            const markdownWithClass = `<div class="markdown-content">${chunk}</div>`;
            return converter.makeHtml(markdownWithClass);
        }).join('');
        document.getElementById('renderedMarkdown').innerHTML = renderedHtml;

        // 处理第二个 Markdown 内容
        const markdownText2 = document.getElementById('renderedMarkdown2').textContent;
        const chunks2 = splitMarkdown(markdownText2, maxLength);
        const renderedHtml2 = chunks2.map(chunk => {
            const markdownWithClass2 = `<div class="markdown-content">${chunk}</div>`;
            return converter.makeHtml(markdownWithClass2);
        }).join('');
        document.getElementById('renderedMarkdown2').innerHTML = renderedHtml2;

        // 为每个 pre 元素添加 data-lang 属性
        document.querySelectorAll('.markdown-content pre').forEach(pre => {
            const code = pre.querySelector('code');
            if (code) {
                const classes = Array.from(code.classList);
                const languageClass = classes.find(cls => cls.startsWith('language-'));
                if (languageClass) {
                    const language = languageClass.replace('language-', '').toUpperCase();
                    pre.setAttribute('data-lang', language);
                }
            }
        });
    </script>
</body>

</html>